(this.webpackJsonppages=this.webpackJsonppages||[]).push([[204],{508:function(e,t,n){"use strict";n.r(t);var o=n(9),i=n(10),s=n(11),r=n(12),a=n(0),c=n.n(a),u=n(2),h=n(14),l=n(68),f=n(1),p=function(e){Object(s.a)(n,e);var t=Object(r.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).handleSubmit=function(e){e.preventDefault(),l.a.logout(),i.setState({username:l.a.getUsername()})},i.state={username:l.a.getUsername()},i}return Object(i.a)(n,[{key:"componentDidMount",value:function(){null!==this.props.title&&void 0!==this.props.title&&(document.title=this.props.title)}},{key:"render",value:function(){var e=this.state.username;return l.a.isLoggedIn()?Object(f.jsx)("div",{className:"form-container",children:Object(f.jsx)("div",{className:"form-box",children:Object(f.jsxs)("div",{className:"form-presentation",children:[Object(f.jsxs)("h2",{className:"form-title",children:["Hello ",e]}),Object(f.jsxs)("div",{className:"form-registration-rules",children:["Thank you for participating. You can get started by selecting ",Object(f.jsx)(h.b,{className:"inline",to:"/participate",children:"participate"})," on the navigation bar at the top."]}),Object(f.jsx)("div",{className:"form-registration-rules",children:"In the future there will be some links here to change your password and email."}),Object(f.jsx)("form",{onSubmit:this.handleSubmit,className:"form-button-padding",children:Object(f.jsx)("input",{className:"active-button form-button-primary",type:"submit",value:"Log Out"})})]})})}):Object(f.jsx)(u.a,{to:"/login?loggedout"})}}]),n}(c.a.Component);t.default=p},68:function(e,t,n){"use strict";var o=n(9),i=n(10),s=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"loginUrl",value:function(e,t){fetch(this.ADDRESS+"/login/").then((function(e){return e.json()})).then((function(t){e(t)}),(function(e){t(e)}))}},{key:"authorize",value:function(e,t,n){var o=this;return fetch(this.ADDRESS+"/login/authorize",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({code:e})}).then((function(e){return e.json()})).then((function(e){o.parseJWT(e),t()}),(function(e){n(e)})),!0}},{key:"authenticate",value:function(e,t,n,o){var i=this;return fetch(this.ADDRESS+"/login/authenticate",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:e,password:t})}).then((function(e){return e.json()})).then((function(e){i.parseJWT(e),n(e)}),(function(e){o(e)})),!0}},{key:"register",value:function(e,t,n,o,i,s){var r=JSON.stringify({username:e,password:t,email:n,agree:o});return(null===n||void 0===n||n.length<1)&&(r=JSON.stringify({username:e,password:t,agree:o})),fetch(this.ADDRESS+"/login/register",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:r}).then((function(e){return e.json()})).then((function(e){i(e)}),(function(e){s(e)})),!0}},{key:"updateLoginButton",value:function(){e.loginButton&&e.loginButton.updateLoginState()}},{key:"refresh",value:function(t,n){var o=this,i=localStorage.getItem(this.REFRESH_TOKEN);return void 0===i?(n("Not logged in."),!1):(fetch(this.ADDRESS+"/login/refresh",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({token:i})}).then((function(e){return e.json()})).then((function(i){void 0!==i.success?i.success?o.parseJWT(i)?t():n("Didn't undertand the response from the server."):(e.logout(),void 0!==i.reason?n(i.reason):n("Unsuccessful refresh of access token.")):n("Unknown error on refreshing access token.")}),(function(e){n(e)})),!0)}},{key:"fetchSecureGET",value:function(e,t,n){var o=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=sessionStorage.getItem(this.ACCESS_TOKEN);return void 0===s||this.isAccessTokenExpired()?i?(this.refresh((function(){o.fetchSecureGET(e,t,n,i=!1)}),n),!0):(n("Not logged in."),!1):(fetch(this.ADDRESS+"/secure/"+e,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s},method:"GET"}).then((function(s){401===s.status&&i?o.refresh((function(){o.fetchSecureGET(e,t,n,i=!1)}),n):s.json().then((function(e){t(e)}),(function(e){n(e)}))})),!0)}},{key:"fetchSecurePOST",value:function(e,t,n,o){var i=this,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=sessionStorage.getItem(this.ACCESS_TOKEN);return void 0===r?s?(this.refresh((function(){i.fetchSecurePOST(e,n,o,s=!1)}),o),!0):(o("Not logged in."),!1):(fetch(this.ADDRESS+"/secure/"+e,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r},method:"POST",body:JSON.stringify(t)}).then((function(r){401===r.status&&s?i.refresh((function(){i.fetchSecurePOST(e,t,n,o,s=!1)}),o):r.json().then((function(e){n(e)}),(function(e){o(e)}))})),!0)}},{key:"getUsername",value:function(){return localStorage.getItem(this.USERNAME)}},{key:"logout",value:function(){sessionStorage.removeItem(this.ACCESS_TOKEN),sessionStorage.removeItem(this.ACCESS_TOKEN_EXPIRY),localStorage.removeItem(this.REFRESH_TOKEN),localStorage.removeItem(this.REFRESH_TOKEN_EXPIRY),localStorage.removeItem(this.USERNAME),this.updateLoginButton()}},{key:"isLoggedIn",value:function(){var t=void 0!==this.getUsername()&&null!==this.getUsername();return t&&e.isRefreshTokenExpired()&&(e.logout(),t=!1),t}},{key:"parseJWT",value:function(e){if(void 0===e.access_token)return this.logout(),!1;sessionStorage.setItem(this.ACCESS_TOKEN,e.access_token),localStorage.setItem(this.REFRESH_TOKEN,e.refresh_token);var t=e.access_token.split(".");if(null!==t&&3===t.length){var n=atob(t[1]);n=JSON.parse(n),sessionStorage.setItem(this.ACCESS_TOKEN_EXPIRY,n.exp)}localStorage.setItem(this.USERNAME,e.username);var o=JSON.parse(atob(e.refresh_token.split(".")[1]));return localStorage.setItem(this.REFRESH_TOKEN_EXPIRY,o.exp),this.updateLoginButton(),!0}},{key:"isAccessTokenExpired",value:function(){var e=sessionStorage.getItem(this.ACCESS_TOKEN_EXPIRY);return void 0===e||null===e||new Date(1e3*parseInt(e))-new Date<0}},{key:"isRefreshTokenExpired",value:function(){var e=localStorage.getItem(this.REFRESH_TOKEN_EXPIRY);return void 0===e||null===e||new Date(1e3*parseInt(e))-new Date<0}},{key:"ACCESS_TOKEN",get:function(){return"access_token"}},{key:"ACCESS_TOKEN_EXPIRY",get:function(){return"access_token_expiry"}},{key:"REFRESH_TOKEN",get:function(){return"refresh_token"}},{key:"REFRESH_TOKEN_EXPIRY",get:function(){return"refresh_token_expiry"}},{key:"USERNAME",get:function(){return"username"}},{key:"ADDRESS",get:function(){return"https://api.brawl.ai"}}]),e}();s.loginButton=null,t.a=s}}]);