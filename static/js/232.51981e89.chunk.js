(this.webpackJsonppages=this.webpackJsonppages||[]).push([[232],{468:function(t,e,r){"use strict";r.r(e);var a=r(63),n=r(95),c=r(1),o=r(0),s=r(448),i=r(114),u=r(451),h=r(283),l=r(392),p=r(393),j=r(394);function m(){var t=Object(o.useRef)(),e=Object(s.d)(),r=e.scene,a=e.gl,n=e.size,i=e.camera;return Object(o.useEffect)((function(){t.current.setSize(n.width,n.height)}),[n]),Object(s.c)((function(){return t.current.render()}),2),Object(c.jsxs)("effectComposer",{ref:t,args:[a],children:[Object(c.jsx)("renderPass",{attachArray:"passes",scene:r,camera:i}),Object(c.jsx)("shaderPass",{attachArray:"passes",args:[p.a],"material-uniforms-resolution-value":[1/n.width,1/n.height],renderToScreen:!0})]})}function d(){var t=Object(s.d)().gl.capabilities.maxTextureSize;return t>4096&&(t=4096),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("ambientLight",{intensity:1.2}),Object(c.jsx)("directionalLight",{castShadow:!0,position:[-10,30,-10],intensity:.7,"shadow-mapSize-width":t,"shadow-mapSize-height":t,"shadow-camera-far":100,"shadow-camera-near":10,"shadow-camera-left":-40,"shadow-camera-right":40,"shadow-camera-top":80,"shadow-camera-bottom":0,"shadow-bias":-.001})]})}function f(t){var e=t.position,r=t.height,a=t.color,n=t.time,i=t.mutation,u=Object(o.useRef)();return Object(s.c)((function(){n<0||(n<=i.clock?(u.current.scale.y=.1,u.current.position.y=.05*r):(u.current.scale.y=1,u.current.position.y=e[1]))})),Object(c.jsxs)("mesh",{castShadow:!0,receiveShadow:!0,position:e,ref:u,scale:[1,1,1],children:[Object(c.jsx)("boxBufferGeometry",{attach:"geometry",args:[1,r,1]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:a})]})}function b(t){var e=t.heightMap,r=t.times,a=t.mutation;if(null==e||null==r)return[];for(var n=[],o=0;o<e.length;o++)for(var s=0;s<e[o].length;s++){var u=e[o][s];if(u>0){var h=new i.Color;h.setRGB(.2,.2,.2),2===u&&h.setRGB(.5,.5,.5);var l=r[o][s];n.push(Object(c.jsx)(f,{position:[s,u/2,o],height:u,color:h,time:l,mutation:a},"box-"+s+"-"+o))}}return n}function g(t){var e=t.shots,r=t.mutation,a=Object(o.useState)(!1),u=Object(n.a)(a,2),h=u[0],l=u[1],p=[],j=Object(o.useRef)(),m=0;if(Object(s.c)((function(){if(null!=e&&e.length>0){for(var t=r.clock;e.length>m+1&&e[m+1].time<=t;)m++;for(;e[m].time>t&&0<m;)m--;var a=e[m];if(a.time<=t&&a.time+a.duration>t){h||l(!0);var n=a.target.x-a.source.x,c=a.target.z-a.source.z,o=Math.atan2(c,n)+Math.PI/2,s=(t-a.time)/a.duration,i=Math.sqrt(n*n+c*c),u=n*s,p=c*s;j.current.position.x=a.source.x+u,j.current.position.z=a.source.z+p;var d=Math.sqrt(u*u+p*p);if(d<1||i-d<1){var f=i-d;d<f&&(f=d),j.current.scale.y=f}else j.current.scale.y=1;j.current.position.y=1.2,j.current.rotation.x=Math.PI/2,j.current.rotation.z=o}else h&&l(!1)}})),h){var d=new i.Color;d.setRGB(.7,.7,.4),p.push(Object(c.jsxs)("mesh",{ref:j,castShadow:!0,receiveShadow:!0,scale:[1,1,1],children:[Object(c.jsx)("cylinderBufferGeometry",{attach:"geometry",args:[.05,.05,1,8,1]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:d})]},"weapon-shot"))}return p}function x(t){var e=t.tosses,r=t.mutation,a=Object(o.useState)(!1),u=Object(n.a)(a,2),h=u[0],l=u[1],p=Object(o.useState)(!1),j=Object(n.a)(p,2),m=j[0],d=j[1],f=[],b=Object(o.useRef)(),g=Object(o.useRef)(),x=Object(o.useRef)(),O=0;if(Object(s.c)((function(){if(null!=e&&e.length>0){for(var t=r.clock;e.length>O+1&&e[O+1].time<=t;)O++;for(;e[O].time>t&&0<O;)O--;var a=e[O];if(a.time<=t&&a.time+a.duration>t){h||l(!0);var n=a.target.x-a.source.x,c=a.target.z-a.source.z,o=(t-a.time)/a.duration,s=n*o,i=c*o;b.current.position.x=a.source.x+s,b.current.position.z=a.source.z+i,b.current.position.y=4*Math.sin(o*Math.PI)+1}else h&&l(!1);if(a.time+a.duration<=t&&a.time+a.duration+500>t){m||(d(!0),g.current.position.y=1.5,g.current.position.x=a.target.x,g.current.position.z=a.target.z);var u=(t-(a.time+a.duration))/500,p=1-2*u,j=1;p<0&&(j=1+p,p=0),x.current.color.r=j,x.current.color.g=p,x.current.color.b=p;var f=1-u*u;x.current.opacity=f,x.current.transparent=f<.99;var v=u*u*20;v>1&&(v=1),g.current.scale.x=v,g.current.scale.y=v,g.current.scale.z=v}else m&&d(!1)}})),h){var v=new i.Color;v.setRGB(.8,.2,.2),f.push(Object(c.jsxs)("mesh",{ref:b,castShadow:!0,receiveShadow:!0,scale:[1,1,1],children:[Object(c.jsx)("sphereBufferGeometry",{attach:"geometry",args:[.1,8,4]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:v})]},"grenade-throw"))}if(m){var y=new i.Color;y.setRGB(.8,.2,.2),f.push(Object(c.jsxs)("mesh",{ref:g,scale:[1,1,1],children:[Object(c.jsx)("boxBufferGeometry",{attach:"geometry",args:[5,3,5]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:y,opacity:.5,ref:x})]},"grenade-explosion"))}return f}function O(t){var e=t.heals,r=t.mutation,a=Object(o.useState)(!1),u=Object(n.a)(a,2),h=u[0],l=u[1],p=Object(o.useState)(!1),j=Object(n.a)(p,2),m=j[0],d=j[1],f=[],b=Object(o.useRef)(),g=Object(o.useRef)(),x=Object(o.useRef)(),O=0;if(Object(s.c)((function(){if(null!=e&&e.length>0){for(var t=r.clock;e.length>O+1&&e[O+1].time<=t;)O++;for(;e[O].time>t&&0<O;)O--;var a=e[O];if(a.time<=t&&a.time+a.duration>t){h||l(!0);var n=a.target.x-a.source.x,c=a.target.z-a.source.z,o=(t-a.time)/a.duration,s=n*o,i=c*o;b.current.position.x=a.source.x+s,b.current.position.z=a.source.z+i,b.current.position.y=2*Math.sin(o*Math.PI)+1}else h&&l(!1);if(a.time+a.duration<=t&&a.time+a.duration+500>t){m||(d(!0),g.current.position.y=1,g.current.position.x=a.target.x,g.current.position.z=a.target.z);var u=(t-(a.time+a.duration))/500,p=1-2*u,j=1;p<0&&(j=1+p,p=0),x.current.color.r=p,x.current.color.g=j,x.current.color.b=p;var f=1-u*u;x.current.opacity=f,x.current.transparent=f<.99;var v=u*u*20;v>1&&(v=1),g.current.scale.x=v,g.current.scale.y=v,g.current.scale.z=v}else m&&d(!1)}})),h){var v=new i.Color;v.setRGB(.2,.8,.2),f.push(Object(c.jsxs)("mesh",{ref:b,castShadow:!0,receiveShadow:!0,scale:[1,1,1],children:[Object(c.jsx)("sphereBufferGeometry",{attach:"geometry",args:[.1,8,4]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:v})]},"grenade-throw"))}if(m){var y=new i.Color;y.setRGB(.2,.8,.2),f.push(Object(c.jsxs)("mesh",{ref:g,scale:[1,1,1],children:[Object(c.jsx)("boxBufferGeometry",{attach:"geometry",args:[1,2,1]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:y,opacity:.5,ref:x})]},"grenade-explosion"))}return f}function v(t){var e=t.reloads,r=t.mutation,a=Object(o.useState)(!1),u=Object(n.a)(a,2),h=u[0],l=u[1],p=Object(o.useState)(!1),j=Object(n.a)(p,2),m=j[0],d=j[1],f=[],b=Object(o.useRef)(),g=Object(o.useRef)(),x=Object(o.useRef)(),O=0;if(Object(s.c)((function(){if(null!=e&&e.length>0){for(var t=r.clock;e.length>O+1&&e[O+1].time<=t;)O++;for(;e[O].time>t&&0<O;)O--;var a=e[O];if(a.time<=t&&a.time+a.duration>t){h||l(!0);var n=a.target.x-a.source.x,c=a.target.z-a.source.z,o=(t-a.time)/a.duration,s=n*o,i=c*o;b.current.position.x=a.source.x+s,b.current.position.z=a.source.z+i,b.current.position.y=2*Math.sin(o*Math.PI)+1}else h&&l(!1);if(a.time+a.duration<=t&&a.time+a.duration+500>t){m||(d(!0),g.current.position.y=1,g.current.position.x=a.target.x,g.current.position.z=a.target.z);var u=(t-(a.time+a.duration))/500,p=1-2*u,j=1;p<0&&(j=1+p,p=0),x.current.color.r=j,x.current.color.g=j,x.current.color.b=p;var f=1-u*u;x.current.opacity=f,x.current.transparent=f<.99;var v=u*u*20;v>1&&(v=1),g.current.scale.x=v,g.current.scale.y=v,g.current.scale.z=v}else m&&d(!1)}})),h){var v=new i.Color;v.setRGB(.8,.8,.2),f.push(Object(c.jsxs)("mesh",{ref:b,castShadow:!0,receiveShadow:!0,scale:[1,1,1],children:[Object(c.jsx)("sphereBufferGeometry",{attach:"geometry",args:[.1,8,4]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:v})]},"grenade-throw"))}if(m){var y=new i.Color;y.setRGB(.8,.8,.2),f.push(Object(c.jsxs)("mesh",{ref:g,scale:[1,1,1],children:[Object(c.jsx)("boxBufferGeometry",{attach:"geometry",args:[1,2,1]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",color:y,opacity:.5,ref:x})]},"grenade-explosion"))}return f}function y(t){var e=t.color,r=t.project,a=t.name,u=t.unit,h=t.mutation,l=[],p=Object(o.useRef)(),j=Object(o.useRef)(),m=0,d=Object(o.useState)(!1),f=Object(n.a)(d,2),b=f[0],g=f[1];Object(s.c)((function(){if(null!=u.events&&u.events.length>0){for(var t=h.clock;u.events.length>m+1&&u.events[m+1].time<=t;)m++;for(;u.events[m].time>t&&0<m;)m--;var e=u.events[m],r=e.location.x,a=e.location.y,n=e.location.z;if(u.events.length>m+1){var c=u.events[m].time,o=u.events[m+1],s=o.location.x-r,i=o.location.y-a,l=o.location.z-n,d=o.time-c;if(0!==d&&t>c){var f=(t-c)/d;r+=s*f,a+=i*f,n+=l*f}}if(p.current.position.x=r,p.current.position.y=a+.9,p.current.position.z=n,null!=e.hit&&e.hit){var x=Math.trunc(t/100)%2===1;x!==b&&g(x)}else b&&g(!1);null!=e.dead&&e.dead?(p.current.scale.x=1.1,p.current.scale.y=.1,p.current.scale.z=1.1,p.current.position.y=a+.09):(p.current.scale.x=1,p.current.scale.y=1,p.current.scale.z=1),null!=e.visible&&(e.visible||null!=e.dead&&e.dead?(j.current.opacity=1,j.current.transparent=!1):(j.current.opacity=.7,j.current.transparent=!0))}}));var x=new i.Color;return x.setRGB(.8,.8,.8),l.push(Object(c.jsxs)("mesh",{ref:p,castShadow:!0,receiveShadow:!0,position:[u.location[0],.9,u.location[1]],scale:[1,1,1],onPointerDown:function(){h.selected=u},onPointerMove:function(){h.selected=null},onPointerOut:function(){h.selected=null},onPointerOver:function(){h.selected=null},onPointerUp:function(){h.selected===u&&h.setUnitToDisplay(u)},children:[Object(c.jsx)("cylinderBufferGeometry",{attach:"geometry",args:[.25,.25,1.8,20,1]}),Object(c.jsx)("meshStandardMaterial",{attach:"material",ref:j,color:b?x:e})]},"mesh"+r+"+"+a)),l}function M(t){var e=t.units,r=t.mutation,n=[],o=new i.Color;o.setRGB(.2745,.5412,.2706),2===e.project&&o.setRGB(.5412,.2706,.2706);var s,u=Object(a.a)(e.units);try{for(u.s();!(s=u.n()).done;){var h=s.value;n.push(Object(c.jsx)(y,{color:o,project:e.project,unit:h,mutation:r},"unit"+e.project+"+"+h.name))}}catch(l){u.e(l)}finally{u.f()}return n}function w(t){var e=t.width,r=t.height,a=t.pixels,n=t.position,o=t.rotation,s=document.createElement("canvas").getContext("2d");s.canvas.width=e,s.canvas.height=r,s.putImageData(new ImageData(new Uint8ClampedArray(a),e,r),0,0);var u=new i.CanvasTexture(s.canvas,i.UVMapping,i.ClampToEdgeWrapping,i.ClampToEdgeWrapping,i.NearestFilter,i.NearestFilter);return Object(c.jsxs)("mesh",{rotation:o,position:n,scale:[1,1,1],children:[Object(c.jsx)("planeBufferGeometry",{attach:"geometry",args:[e,r]}),Object(c.jsx)("meshBasicMaterial",{attach:"material",map:u})]})}function S(t){var e=t.heightMap,r=[],a=e[0].length,n=e.length,o=[a/2-.5,0,n/2-.5];r.push(Object(c.jsxs)("mesh",{receiveShadow:!0,rotation:[-Math.PI/2,0,0],position:o,scale:[1,1,1],children:[Object(c.jsx)("planeBufferGeometry",{attach:"geometry",args:[a,n]}),Object(c.jsx)("shadowMaterial",{attach:"material",opacity:.3})]},"ground-shadow"));for(var s=[],i=[],u=[],h=[],l=[],p=130,j=120,m=0;m<e.length;m++){for(var d=0;d<e[m].length;d++)(d+m)%2===1?(s.push(p),s.push(p),s.push(p),s.push(255)):(s.push(j),s.push(j),s.push(j),s.push(255)),0===m&&(d%2===1?(i.push(Math.trunc(104)),i.push(Math.trunc(104)),i.push(Math.trunc(104)),i.push(255),u.push(Math.trunc(96)),u.push(Math.trunc(96)),u.push(Math.trunc(96)),u.push(255)):(i.push(Math.trunc(96)),i.push(Math.trunc(96)),i.push(Math.trunc(96)),i.push(255),u.push(Math.trunc(104)),u.push(Math.trunc(104)),u.push(Math.trunc(104)),u.push(255)));m%2===1?(h.push(Math.trunc(96)),h.push(Math.trunc(96)),h.push(Math.trunc(96)),h.push(255),l.push(Math.trunc(104)),l.push(Math.trunc(104)),l.push(Math.trunc(104)),l.push(255)):(h.push(Math.trunc(104)),h.push(Math.trunc(104)),h.push(Math.trunc(104)),h.push(255),l.push(Math.trunc(96)),l.push(Math.trunc(96)),l.push(Math.trunc(96)),l.push(255))}return r.push(Object(c.jsx)(w,{rotation:[-Math.PI/2,0,0],position:o,width:a,height:n,pixels:s},"ground-colour")),r.push(Object(c.jsx)(w,{rotation:[0,Math.PI,0],position:[a/2-.5,-.5,-.5],width:a,height:1,pixels:i},"ground-colour-front")),r.push(Object(c.jsx)(w,{rotation:[0,0,0],position:[a/2-.5,-.5,n-.5],width:a,height:1,pixels:u},"ground-colour-back")),r.push(Object(c.jsx)(w,{rotation:[0,Math.PI/2,0],position:[a-.5,-.5,n/2-.5],width:n,height:1,pixels:h},"ground-colour-left")),r.push(Object(c.jsx)(w,{rotation:[0,-Math.PI/2,0],position:[-.5,-.5,n/2-.5],width:n,height:1,pixels:l},"ground-colour-right")),r}Object(s.b)({EffectComposer:u.a,ShaderPass:h.a,RenderPass:l.a,OrbitControls:j.a});var z=function(t){var e=t.target,r=Object(s.d)(),a=r.camera,n=r.gl.domElement,i=Object(o.useRef)();return Object(s.c)((function(){return i.current.update()})),a.position.set(e[0],70,0),a.far=200,a.near=.1,Object(c.jsx)("orbitControls",{ref:i,args:[a,n],target:e,enableDamping:!0,maxPolarAngle:Math.PI/2,minPolarAngle:0})};function R(t){var e=t.mutation,r=0;return Object(s.c)((function(){if(e.playing){var t=Date.now();if(null!=e.lastUpdate){var a=e.clock+(t-e.lastUpdate);a>e.maxClock&&(a=e.maxClock,e.clock=a,e.stopPlaying()),e.clock=a}e.lastUpdate=t}else null!=e.lastUpdate&&(e.lastUpdate=null);if(r!==e.clock&&(r=e.clock,e.setTime(r),e.setTimeForLog(r),e.setTimeForUnitPanel(r),0!==e.maxClock)){var n=r/e.maxClock*100;e.setProgressBarPercentage(n)}})),[]}e.default=function(t){var e=t.heightMap,r=t.heightMapTimes,a=t.units1,n=t.units2,o=t.shots,u=t.target,h=t.tosses,l=t.heals,p=t.reloads,j=t.mutation;return Object(c.jsxs)(s.a,{className:"results-canvas",shadowMap:!0,colorManagement:!0,onCreated:function(t){var e=t.gl;e.toneMapping=i.ACESFilmicToneMapping,e.outputEncoding=i.sRGBEncoding},children:[Object(c.jsx)(d,{}),Object(c.jsx)(b,{heightMap:e,times:r,mutation:j}),Object(c.jsx)(S,{heightMap:e}),Object(c.jsx)(M,{units:a,mutation:j}),Object(c.jsx)(M,{units:n,mutation:j}),Object(c.jsx)(g,{shots:o,mutation:j}),Object(c.jsx)(x,{tosses:h,mutation:j}),Object(c.jsx)(O,{heals:l,mutation:j}),Object(c.jsx)(v,{reloads:p,mutation:j}),Object(c.jsx)(z,{target:u}),Object(c.jsx)(m,{}),Object(c.jsx)(R,{mutation:j})]})}}}]);